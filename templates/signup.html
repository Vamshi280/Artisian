<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration</title>
    <script>
        function checkUsername() {
            var username = document.getElementById('id_username').value;
            console.log('Checking username:', username);
        
            // Get the CSRF token from the form
            var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
            // Make an AJAX request to your Django view to check if the username exists
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/check_username/', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            // Set the CSRF token in the request headers
            xhr.setRequestHeader('X-CSRFToken', csrftoken);
        
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    if (response.exists) {
                        // Username exists, display an error message
                        document.getElementById('username-error').innerText = 'Username already exists.';
                    } else {
                        // Username is unique, clear the error message
                        document.getElementById('username-error').innerText = '';
                    }
                }
            };
            xhr.send(JSON.stringify({ username: username }));
        }
        
        </script>
        
</head>
<body>
    <h2>Sign Up</h2>
    <form action="{% url 'register' %}" method="post">
        {% csrf_token %}
        
        <!-- First Name -->
        <label for="id_first_name">First Name:</label>
        <input type="text" id="id_first_name" name="first_name" required><br>

        <!-- Last Name -->
        <label for="id_last_name">Last Name:</label>
        <input type="text" id="id_last_name" name="last_name" required><br>

        <!-- Username -->
        <label for="id_username">Username:</label>
        <input type="text" id="id_username" name="username" required onchange="checkUsername()"><br>
        <span id="username-error" style="color: red;"></span><br>

        <!-- Phone Number -->
        <label for="id_phone_number">Phone Number:</label>
        <input type="text" id="id_phone_number" name="phone_number" required><br>

        <!-- Email Address -->
        <label for="id_email">Email:</label>
        <input type="email" id="id_email" name="email" required><br>

        <!-- Address -->
        <label for="id_address">Address:</label>
        <textarea id="id_address" name="address" required></textarea><br>

        <!-- Pin Code -->
        <label for="id_pincode">Pin Code:</label>
        <input type="text" id="id_pincode" name="pincode" required><br>

        <!-- User Type (Radio Buttons) -->
        <label>User Type:</label><br>
        <input type="radio" id="customer" name="user_type" value="customer" checked>
        <label for="customer">Customer</label><br>
        <input type="radio" id="artisan" name="user_type" value="artisan">
        <label for="artisan">Artisan</label><br>

        <!-- Password -->
        <label for="id_password">Password:</label>
        <input type="password" id="id_password" name="password" required><br>

        <!-- Confirm Password -->
        <label for="id_confirm_password">Confirm Password:</label>
        <input type="password" id="id_confirm_password" name="confirm_password" required><br>

        <!-- Submit Button -->
        <button type="submit">Sign Up</button>
    </form>

    <!-- Link to Login Page -->
    <p>Already have an account? <a href="{% url 'login' %}">Login</a></p>
</body>
</html>
